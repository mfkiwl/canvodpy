graph TB
    %% Configuration Layer
    subgraph config["ðŸ”§ User Configuration"]
        env[".env<br/><small>CDDIS_MAIL<br/>GNSS_ROOT_DIR</small>"]
        processing["processing.yaml<br/><small>metadata, credentials<br/>aux_data settings</small>"]
        sites["sites.yaml<br/><small>research sites</small>"]
        sids["sids.yaml<br/><small>signal IDs</small>"]
    end

    %% Umbrella Package
    subgraph umbrella["ðŸŽ¯ canvodpy (Umbrella Package)"]
        settings["settings.py<br/><small>AppSettings<br/>get_settings()</small>"]
        globals["globals.py<br/><small>AGENCY, FTP_SERVER<br/>SP3_FILE_PATH, CLK_FILE_PATH</small>"]
        orchestrator["orchestrator/<br/><small>RinexDataProcessor<br/>PipelineOrchestrator<br/>SingleReceiverProcessor</small>"]
        logging["logging/"]
        research_sites["research_sites_config.py"]
        api["api.py"]
    end

    %% Core Layer
    subgraph core["ðŸ”¹ Core Layer (No Dependencies)"]
        utils["canvod.utils<br/><small>â€¢ YYYYDOY<br/>â€¢ gpsweekday<br/>â€¢ date_utils</small>"]
        grids["canvod.grids<br/><small>â€¢ Grid operations</small>"]
    end

    %% Base Layer
    readers["canvod.readers<br/><small>â€¢ Rnxv3Obs<br/>â€¢ DataDirMatcher<br/>â€¢ MatchedDirs<br/>â€¢ SignalIDMapper</small>"]

    %% Mid-tier Layer
    subgraph midtier["ðŸ”¸ Mid-tier Packages"]
        aux["canvod.aux<br/><small>â€¢ AuxDataPipeline<br/>â€¢ Sp3File, ClkFile<br/>â€¢ ECEFPosition<br/>â€¢ interpolation</small>"]
        store["canvod.store<br/><small>â€¢ GnssResearchSite<br/>â€¢ IcechunkDataReader<br/>â€¢ IcechunkPreprocessor</small>"]
        viz["canvod.viz<br/><small>â€¢ Visualization</small>"]
    end

    %% Processing Layer
    vod["canvod.vod<br/><small>â€¢ VOD calculations</small>"]

    %% Configuration dependencies
    env -.-> settings
    processing -.-> settings
    sites -.-> research_sites
    sids -.-> orchestrator

    settings ==> orchestrator
    globals ==> orchestrator
    globals ==> aux
    globals ==> store
    research_sites ==> store
    logging ==> store

    %% Core dependencies
    utils --> readers
    utils --> aux
    utils --> store
    grids --> store
    grids --> viz

    %% Readers dependencies
    readers --> aux
    readers --> store

    %% Mid-tier dependencies
    aux --> store
    store -.->|optional| aux
    store --> vod
    vod -.->|optional| store

    %% Umbrella dependencies
    readers ==> orchestrator
    aux ==> orchestrator
    store ==> orchestrator
    utils ==> orchestrator
    vod ==> orchestrator

    %% Styling
    classDef configNode fill:#e1f5ff,stroke:#0066cc,stroke-width:2px,color:#000
    classDef umbrellaNode fill:#fff4e6,stroke:#ff9800,stroke-width:3px,color:#000
    classDef coreNode fill:#e8f5e9,stroke:#4caf50,stroke-width:2px,color:#000
    classDef baseNode fill:#fff3e0,stroke:#ff6f00,stroke-width:2px,color:#000
    classDef midNode fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px,color:#000
    classDef vodNode fill:#fce4ec,stroke:#e91e63,stroke-width:2px,color:#000

    class env,processing,sites,sids configNode
    class settings,globals,orchestrator,logging,research_sites,api umbrellaNode
    class utils,grids coreNode
    class readers baseNode
    class aux,store,viz midNode
    class vod vodNode
