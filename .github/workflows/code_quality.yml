name: Python Code Quality

on: [push]

jobs:
    lock_file:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - uses: ./.github/actions/setup
            - run: uv lock --check

    linting:
        runs-on: ubuntu-latest
        needs: [lock_file]
        steps:
            - uses: actions/checkout@v4
            - uses: ./.github/actions/setup
            - name: Lint with ruff
              run: uv run ruff check .
              # Allow failure for now - we have 512 known issues
              # Will address systematically during type hints/docstrings phase
              continue-on-error: true

    formatting:
        runs-on: ubuntu-latest
        needs: [lock_file]
        steps:
            - uses: actions/checkout@v4
            - uses: ./.github/actions/setup
            - name: Check formatting
              run: uv run ruff format --check .

    type_consistency:
        runs-on: ubuntu-latest
        needs: [lock_file]
        steps:
            - uses: actions/checkout@v4
            - uses: ./.github/actions/setup
            - run: uv sync --locked --dev
            - name: Type check with ty
              run: uv run ty check .
              # Allow failure for now - type hints not yet added
              # This is a future goal after testing is complete
              continue-on-error: true
