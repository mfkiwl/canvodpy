name: Python Code Quality

on: [push]

jobs:
    lock_file:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - uses: ./.github/actions/setup
            - uses: ./.github/actions/setup-just
            - name: Check uv.lock is up to date
              run: just check-lock

    linting:
        runs-on: ubuntu-latest
        needs: [lock_file]
        steps:
            - uses: actions/checkout@v4
            - uses: ./.github/actions/setup
            - uses: ./.github/actions/setup-just
            - name: Lint with ruff
              run: just check-lint-only
              # Allow failure for now - we have 512 known issues
              # Will address systematically during type hints/docstrings phase
              continue-on-error: true

    formatting:
        runs-on: ubuntu-latest
        needs: [lock_file]
        steps:
            - uses: actions/checkout@v4
            - uses: ./.github/actions/setup
            - uses: ./.github/actions/setup-just
            - name: Check formatting
              run: just check-format-only

    type_consistency:
        runs-on: ubuntu-latest
        needs: [lock_file]
        steps:
            - uses: actions/checkout@v4
            - uses: ./.github/actions/setup
            - uses: ./.github/actions/setup-just
            - run: uv sync --locked --dev
            - name: Type check with ty
              run: just check-types
              # Allow failure for now - type hints not yet added
              # This is a future goal after testing is complete
              continue-on-error: true
