flowchart TD
    Start([ğŸš€ Start Processing]) --> Input

    subgraph Input["ğŸ“¥ Data Ingestion"]
        RINEX["ğŸ“„ RINEX Files<br/>(Observations)"]
        SP3["ğŸ›°ï¸ SP3 Files<br/>(Orbits)"]
        CLK["â° CLK Files<br/>(Clocks)"]
    end

    subgraph Reading["ğŸ” Reading & Parsing"]
        RinexReader["Rnxv3Obs<br/>Parse RINEX v3.04"]
        AuxReader["SP3/CLK Parsers<br/>Load Auxiliary Data"]
    end

    subgraph Processing["âš™ï¸ Processing"]
        Interp["Interpolation<br/>Orbit/Clock to Obs Times"]
        Position["Position Calculation<br/>ECEF â†’ Spherical (r,Î¸,Ï†)"]
        Augment["Dataset Augmentation<br/>Merge RINEX + Aux"]
    end

    subgraph Storage["ğŸ’¾ Storage"]
        Icechunk["Icechunk Store<br/>Versioned Datasets"]
    end

    subgraph Analysis["ğŸ“Š Analysis"]
        GridAssign["Grid Assignment<br/>Map to Hemisphere Cells"]
        VODCalc["VOD Calculation<br/>Tau-Omega Model"]
        Aggregate["Aggregation<br/>Per-cell Statistics"]
    end

    subgraph Output["ğŸ“ˆ Output"]
        Viz2D["2D Hemisphere Plots<br/>Polar Projection"]
        Viz3D["3D Interactive Plots<br/>Plotly Surface"]
        Export["Data Export<br/>NetCDF/CSV"]
    end

    RINEX --> RinexReader
    SP3 --> AuxReader
    CLK --> AuxReader

    RinexReader --> Augment
    AuxReader --> Interp
    Interp --> Position
    Position --> Augment

    Augment --> Icechunk
    Icechunk --> GridAssign
    GridAssign --> VODCalc
    VODCalc --> Aggregate

    Aggregate --> Viz2D
    Aggregate --> Viz3D
    Aggregate --> Export

    Viz2D --> End([âœ… Complete])
    Viz3D --> End
    Export --> End

    style Start fill:#4caf50,stroke:#1b5e20,stroke-width:3px,color:#fff
    style End fill:#4caf50,stroke:#1b5e20,stroke-width:3px,color:#fff
    style Input fill:#fff3e0,stroke:#e65100,stroke-width:2px
    style Reading fill:#ffecb3,stroke:#f57c00,stroke-width:2px
    style Processing fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
    style Storage fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    style Analysis fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
    style Output fill:#e0f2f1,stroke:#00695c,stroke-width:2px
