flowchart LR
    subgraph ACQ["Acquisition"]
        RINEX["RINEX 3.04\n(SNR, PR, Phase)"]
        SP3["SP3 Precise\nEphemerides"]
        CLK["CLK Precise\nClocks"]
    end

    subgraph PREP_R["Preprocessing"]
        PARSE["Parse & Hermite\nInterpolation"]
        AUX["Auxiliary Dataset\n(ECEF positions)"]
        SCS_R["ECEF → Spherical\n(θ, φ)"]
    end

    subgraph STORE["Storage"]
        ICE["Icechunk Store\n(obs dataset)"]
    end

    subgraph GRID["Gridding"]
        HGRID["Hemispheric Grid\n(equal-area / HEALPix)"]
        KDTREE["KDTree Assignment\nO(n log m)"]
    end

    subgraph VOD["VOD Retrieval"]
        PAIR["Canopy / Reference\nDataset Pairing"]
        TAU["Zeroth-order\nTau-Omega Inversion\nVOD = −ln(T)·cos(θ)"]
    end

    OUT["VOD Dataset\n(epoch × cell)"]

    RINEX --> PARSE
    SP3 --> PARSE
    CLK --> PARSE
    PARSE --> AUX
    AUX --> SCS_R
    SCS_R --> ICE

    ICE --> HGRID
    HGRID --> KDTREE
    KDTREE --> PAIR
    PAIR --> TAU
    TAU --> OUT
