flowchart LR
    subgraph ACQ[Acquisition]
        RINEX["RINEX 3.04<br/>(SNR, PR, Phase)"]
        SP3["SP3 Precise<br/>Ephemerides"]
        CLK["CLK Precise<br/>Clocks"]
    end

    subgraph PREP_R[Preprocessing]
        PARSE["Parse and Hermite<br/>Interpolation"]
        AUX["Auxiliary Dataset<br/>(ECEF positions)"]
        SCS_R["ECEF → Spherical<br/>(θ, φ)"]
    end

    subgraph STORE[Storage]
        ICE["Icechunk Store<br/>(obs dataset)"]
    end

    subgraph VOD[VOD Retrieval]
        PAIR["Canopy / Reference<br/>Dataset Pairing"]
        TAU["Zeroth-order Tau-Omega Inversion<br/>VOD = −ln(T)·cos(θ)"]
    end

    subgraph GRID[Gridding]
        HGRID["Hemispheric Grid<br/>(equal-area / HEALPix)"]
        KDTREE["KDTree Assignment<br/>O(n log m)"]
    end

    OUT["VOD Dataset<br/>(epoch × cell)"]

    RINEX --> PARSE
    SP3 --> PARSE
    CLK --> PARSE
    PARSE --> AUX
    AUX --> SCS_R
    SCS_R --> ICE

    ICE --> PAIR
    PAIR --> TAU
    TAU --> OUT
    OUT --> HGRID
    HGRID --> KDTREE
