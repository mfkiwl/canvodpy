flowchart LR
    subgraph CONFIG["YAML Configuration"]
        PROC["processing.yaml  Processing parameters Storage paths Compression settings NASA credentials"]
        SITES["sites.yaml  Receiver definitions Directory mappings VOD analysis pairs"]
        SIDS["sids.yaml  Signal ID filters (system, band, code)"]
    end

    subgraph LOADER["Configuration Loader"]
        DEFAULTS["Package Defaults (built-in YAML)"]
        MERGE["Deep Merge (user overrides defaults)"]
        PYDANTIC["Pydantic Validation (type safety, constraints)"]
    end

    subgraph VALIDATED["CanvodConfig (validated)"]
        PC["ProcessingConfig   ProcessingParams   StorageConfig   IcechunkConfig   MetadataConfig"]
        SC["SitesConfig   ReceiverConfig   VODAnalysisConfig"]
        SIC["SidsConfig   Signal filters"]
    end

    subgraph VERSIONED["Versioned Data Storage"]
        IC_WRITE["Icechunk Write (atomic commits)"]
        SNAPSHOT["Snapshot ID (content-addressable)"]
        BRANCH["Branch Management (main, rechunk)"]
        METADATA["Metadata Parquet (RINEX hash, epochs, snapshot, timestamp)"]
    end

    subgraph PROVENANCE["Full Provenance"]
        TRACE["Every dataset traceable to:   Config version   RINEX file hash   Snapshot ID   Processing timestamp"]
    end

    PROC --> MERGE
    SITES --> MERGE
    SIDS --> MERGE
    DEFAULTS --> MERGE
    MERGE --> PYDANTIC
    PYDANTIC --> PC
    PYDANTIC --> SC
    PYDANTIC --> SIC

    PC --> IC_WRITE
    IC_WRITE --> SNAPSHOT
    SNAPSHOT --> METADATA
    BRANCH --> SNAPSHOT
    METADATA --> TRACE
    SC --> TRACE
