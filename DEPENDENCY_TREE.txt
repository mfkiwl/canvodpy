# canVODpy Package Dependency Tree

**Quick Reference - Text-based dependency visualization**

```
ğŸ“ canVODpy Project Structure
â”‚
â”œâ”€â”€ ğŸ”§ User Configuration
â”‚   â”œâ”€â”€ .env (CDDIS_MAIL, GNSS_ROOT_DIR)
â”‚   â””â”€â”€ canvodpy/config/
â”‚       â”œâ”€â”€ processing.yaml (metadata, credentials, aux_data)
â”‚       â”œâ”€â”€ sites.yaml (research site definitions)
â”‚       â””â”€â”€ sids.yaml (signal ID configurations)
â”‚
â”œâ”€â”€ ğŸ¯ canvodpy (Umbrella Package)
â”‚   â”œâ”€â”€ settings.py â—„â”€â”€ Loads .env & processing.yaml
â”‚   â”œâ”€â”€ globals.py â—„â”€â”€ Default constants (AGENCY, FTP_SERVER, paths)
â”‚   â”œâ”€â”€ orchestrator/
â”‚   â”‚   â”œâ”€â”€ processor.py (RinexDataProcessor)
â”‚   â”‚   â”œâ”€â”€ pipeline.py (PipelineOrchestrator)
â”‚   â”‚   â””â”€â”€ matcher.py (DatasetMatcher)
â”‚   â”œâ”€â”€ logging/
â”‚   â”œâ”€â”€ research_sites_config.py â—„â”€â”€ Loads sites.yaml
â”‚   â””â”€â”€ api.py
â”‚   â”‚
â”‚   â””â”€â”€ Depends on ALL namespace packages â†“
â”‚
â””â”€â”€ ğŸ”¹ Namespace Packages (canvod.*)
    â”‚
    â”œâ”€â”€ Layer 0: Core (No Dependencies)
    â”‚   â”œâ”€â”€ canvod.utils
    â”‚   â”‚   â””â”€â”€ tools/ (YYYYDOY, gpsweekday, date_utils)
    â”‚   â””â”€â”€ canvod.grids
    â”‚       â””â”€â”€ Grid operations
    â”‚
    â”œâ”€â”€ Layer 1: Base
    â”‚   â””â”€â”€ canvod.readers â—„â”€â”€ canvod.utils
    â”‚       â”œâ”€â”€ Rnxv3Obs (RINEX v3.04 parser)
    â”‚       â”œâ”€â”€ DataDirMatcher (Directory matching)
    â”‚       â”œâ”€â”€ MatchedDirs (Matched directory container)
    â”‚       â””â”€â”€ gnss_specs/ (GNSS bands, signals, constellations)
    â”‚
    â”œâ”€â”€ Layer 2: Mid-tier
    â”‚   â”œâ”€â”€ canvod.aux â—„â”€â”€ canvod.readers, canvod.utils
    â”‚   â”‚   â”‚           â—„â”€â”€ canvodpy.globals, canvodpy.settings
    â”‚   â”‚   â”‚           â—„â”€â”€ canvod.store (optional/lazy)
    â”‚   â”‚   â”œâ”€â”€ AuxDataPipeline (Orchestrate aux data)
    â”‚   â”‚   â”œâ”€â”€ Sp3File, ClkFile (Ephemeris & clock files)
    â”‚   â”‚   â”œâ”€â”€ ECEFPosition, spherical_coordinates
    â”‚   â”‚   â””â”€â”€ interpolation utilities
    â”‚   â”‚
    â”‚   â”œâ”€â”€ canvod.store â—„â”€â”€ canvod.grids, canvod.readers, canvod.utils
    â”‚   â”‚   â”‚            â—„â”€â”€ canvod.aux (optional/lazy)
    â”‚   â”‚   â”‚            â—„â”€â”€ canvodpy.globals, canvodpy.logging
    â”‚   â”‚   â”‚            â—„â”€â”€ canvodpy.research_sites_config
    â”‚   â”‚   â”œâ”€â”€ GnssResearchSite (Site management)
    â”‚   â”‚   â”œâ”€â”€ IcechunkDataReader (Icechunk store reader)
    â”‚   â”‚   â””â”€â”€ IcechunkPreprocessor (Preprocessing)
    â”‚   â”‚
    â”‚   â””â”€â”€ canvod.viz â—„â”€â”€ canvod.grids
    â”‚       â””â”€â”€ Visualization tools
    â”‚
    â””â”€â”€ Layer 3: Processing
        â””â”€â”€ canvod.vod â—„â”€â”€ canvod.store
            â””â”€â”€ VOD calculation functions


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
DEPENDENCY SUMMARY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Package Dependencies (from pyproject.toml):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Package         â”‚ Depends On                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ canvod.utils    â”‚ (none)                                          â”‚
â”‚ canvod.grids    â”‚ (none)                                          â”‚
â”‚ canvod.readers  â”‚ (none declared, uses canvod.utils at runtime)   â”‚
â”‚ canvod.aux      â”‚ canvod-readers                                  â”‚
â”‚ canvod.store    â”‚ canvod-grids                                    â”‚
â”‚ canvod.viz      â”‚ canvod-grids                                    â”‚
â”‚ canvod.vod      â”‚ (none declared, uses canvod.store at runtime)   â”‚
â”‚ canvodpy        â”‚ ALL namespace packages                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Runtime Import Dependencies (actual code usage):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Package         â”‚ Runtime Imports                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ canvod.readers  â”‚ canvod.utils                                    â”‚
â”‚ canvod.aux      â”‚ canvod.readers, canvod.utils, canvod.store,     â”‚
â”‚                 â”‚ canvodpy.globals, canvodpy.settings             â”‚
â”‚ canvod.store    â”‚ canvod.aux, canvod.readers, canvod.utils,       â”‚
â”‚                 â”‚ canvod.vod, canvodpy.globals, canvodpy.logging, â”‚
â”‚                 â”‚ canvodpy.research_sites_config                  â”‚
â”‚ canvod.viz      â”‚ canvod.grids                                    â”‚
â”‚ canvod.vod      â”‚ canvod.store                                    â”‚
â”‚ canvodpy        â”‚ All canvod.* packages, all canvodpy modules     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CONFIGURATION FLOW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

User Configuration â†’ Settings â†’ Globals â†’ Packages

.env                      settings.py              globals.py
â”œâ”€â”€ CDDIS_MAIL    â”€â”€â”€â”€â”€â†’  AppSettings      â”€â”€â”€â”€â”€â†’  AGENCY: "COD"
â””â”€â”€ GNSS_ROOT_DIR         â”‚                        PRODUCT_TYPE: "final"
                          â”‚                        FTP_SERVER: "ftp://..."
processing.yaml           â”‚                        SP3_FILE_PATH: "..."
â”œâ”€â”€ metadata      â”€â”€â”€â”€â”€â†’  â”‚                        CLK_FILE_PATH: "..."
â”œâ”€â”€ credentials           â”‚                        â”‚
â””â”€â”€ aux_data              â”‚                        â”‚
                          â”‚                        â”‚
sites.yaml                â”‚                        â”‚
â””â”€â”€ sites         â”€â”€â”€â”€â”€â†’  research_sites_config    â”‚
                          â”‚                        â”‚
                          â–¼                        â–¼
                    canvod.aux.pipeline      canvod.store
                    (uses settings.get_user_email()
                     for CDDIS FTP auth)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CIRCULAR DEPENDENCIES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Identified: canvod.aux â†” canvod.store

Resolution: Optional/lazy imports
  - canvod.aux imports canvod.store components only when needed
  - canvod.store imports canvod.aux components only when needed
  - Example:
    ```python
    # In canvod.aux.pipeline
    def load_preprocessor(self):
        from canvod.store.preprocessing import IcechunkPreprocessor
        return IcechunkPreprocessor(...)
    ```

Status: âœ… Resolved via lazy imports


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PACKAGE EXPORT APIS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

canvod.utils:
  from canvod.utils.tools import YYYYDOY, gpsweekday

canvod.readers:
  from canvod.readers import Rnxv3Obs, DataDirMatcher, MatchedDirs
  from canvod.readers.gnss_specs.signals import SignalIDMapper

canvod.aux:
  from canvod.aux import AuxDataPipeline, Sp3File, ClkFile
  from canvod.aux.position import ECEFPosition, compute_spherical_coordinates
  from canvod.aux.interpolation import create_interpolator_from_attrs

canvod.store:
  from canvod.store import GnssResearchSite, IcechunkDataReader
  from canvod.store.preprocessing import IcechunkPreprocessor

canvod.viz:
  from canvod.viz import ...

canvod.vod:
  from canvod.vod import ...

canvodpy:
  from canvodpy.orchestrator import RinexDataProcessor, PipelineOrchestrator
  from canvodpy.settings import get_settings, AppSettings
  from canvodpy.globals import AGENCY, PRODUCT_TYPE, FTP_SERVER


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
USAGE EXAMPLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Using Configuration:
  ```python
  from canvodpy.settings import get_settings
  from canvodpy.globals import AGENCY, FTP_SERVER
  
  settings = get_settings()
  email = settings.get_user_email()      # From .env or processing.yaml
  root = settings.gnss_root_path          # Data directory
  
  print(f"Agency: {AGENCY}")              # From globals
  print(f"FTP: {FTP_SERVER}")             # From globals
  ```

2. High-Level Orchestration:
  ```python
  from canvodpy.orchestrator import RinexDataProcessor
  
  processor = RinexDataProcessor(rinex_file="data.25o")
  processor.process()
  ```

3. Low-Level Components:
  ```python
  from canvod.readers import Rnxv3Obs, MatchedDirs
  from canvod.aux import AuxDataPipeline
  from canvod.utils.tools import YYYYDOY
  
  md = MatchedDirs(
      canopy_data_dir="path/canopy/25001",
      sky_data_dir="path/sky/25001",
      yyyydoy=YYYYDOY.from_str("2025001")
  )
  
  pipeline = AuxDataPipeline.create_standard(matched_dirs=md)
  pipeline.load_all()
  ephemerides = pipeline.get_ephemerides()
  ```


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
KEY DESIGN PRINCIPLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Namespace Packaging (PEP 420)
   âœ… 7 independent packages under canvod.* namespace
   âœ… No __init__.py in namespace roots
   âœ… Packages can be extracted to separate repos

2. Umbrella Package
   âœ… canvodpy provides high-level orchestration
   âœ… Depends on all namespace packages
   âœ… Provides settings & globals infrastructure

3. Configuration Hierarchy
   User Config â†’ Settings â†’ Globals â†’ Package Defaults

4. Dependency Layers
   Layer 0: utils, grids (no deps)
   Layer 1: readers (â†’ utils)
   Layer 2: aux, store, viz (â†’ Layers 0/1)
   Layer 3: vod (â†’ Layer 2)
   Layer 4: canvodpy (â†’ all)

5. Modular & Extractable
   Each package is self-contained and can be:
   - Developed independently
   - Tested independently
   - Published independently to PyPI
   - Extracted to separate repository


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FILES CREATED
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“„ CANVODPY_DEPENDENCY_GRAPH.md - Comprehensive dependency documentation
ğŸ“„ DEPENDENCY_GRAPH.mmd - Mermaid diagram (for visualization)
ğŸ“„ DEPENDENCY_TREE.txt - This file (quick text reference)
